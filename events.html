<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CHINESE OPEN SCIENCE NETWORK</title>
  <!-- MDB icon -->
  <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <link rel="stylesheet" href="css/google_fonts.css">
  <!-- Google Fonts Roboto -->
<!--   <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
  /> -->
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- MDB -->
  <link rel="stylesheet" href="css/mdb.min.css" />
  <!-- Custom styles -->
  <link rel="stylesheet" href="css/custom.css" />
  <style>
  </style>
</head>
<body>
<header>

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary text-white mb-4">
    <a class="navbar-brand" href="index.html">
      <img
        src="img/logo_w.png"
        height="50"
        alt=""
        loading="lazy"
      />
    </a>
    <!-- Toggle button -->
    <button
      class="navbar-toggler"
      type="button"
      data-mdb-toggle="collapse"
      data-mdb-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link text-white" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="index.html#Members">Members</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="https://github.com/Chinese-Open-Science-Network/site/issues" target="_blank">Articles</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="https://github.com/Chinese-Open-Science-Network/site/labels/Resources" target="_blank">Resources</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link text-white" href="#">Events</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="positions.html">Positions</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="gathering.html">Gathering</a>
        </li>
      </ul>
      
      <button type="button" class="btn btn-outline-light btn-rounded btn-sm mr-2"><a href="http://addevent.open-sci.cn" target="_blank" class="text-white">Add event</a></button>
      <button type="button" class="btn btn-outline-light btn-rounded btn-sm mr-2"><a href="http://addposition.open-sci.cn" target="_blank" class="text-white">Add position</a></button>
      <button type="button" class="btn btn-outline-light btn-rounded btn-sm mr-5"><a href="http://addgathering.open-sci.cn" target="_blank" class="text-white">Add gathering</a></button>
    </div>
  </nav>

</header>


<div class="container">
  <button type="button" id="btn_opentalk" class="btn bg-primary btn-rounded text-white" onclick="show_opentalk_events()">Show OpenTalk Only</button>
  <button type="button" id="btn_all" class="btn bg-primary btn-rounded text-white" onclick="show_all_events()">Show All Events</button>
  <div class="row mt-2" id='e_list'>
  </div>
</div>
  

</div>

<!-- Footer -->
<footer class="page-footer font-small blue pt-4 bg-primary text-white">

  <!-- Footer Links -->
  <div class="container-fluid text-center text-md-left">

    <!-- Grid row -->
    <div class="row">
      <!-- Grid column -->
      <div class="col-md-6 mt-md-0 mt-3">

        <!-- Content -->
        <h5 class="text-uppercase">CHINESE OPEN SCIENCE NETWORK</h5>
        <ul class="list-group list-group-horizontal d-flex justify-content-center">
          <li class="list-group-item border-0 bg-primary"><a target="_blank" href="https://github.com/Chinese-Open-Science-Network" class="nav-link text-white"><i class="fab fa-github"></i></a></li>
          <li class="list-group-item border-0 bg-primary"><a target="_blank" href="https://twitter.com/OpenSciChina" class="nav-link text-white"><i class="fab fa-twitter"></i></a></li>
          <li class="list-group-item border-0 bg-primary"><a target="_blank" href="https://www.youtube.com/channel/UC5M4-E8pkO4vJT9K7rT72Uw" class="nav-link text-white"><i class="fab fa-youtube"></i></a></li>
          <li class="list-group-item border-0 bg-primary"><a target="_blank" href="https://space.bilibili.com/252509184" class="nav-link text-white">Bilibili</a></li>
          <li class="list-group-item border-0 bg-primary"><a target="_blank" href="https://osf.io/9d7y4/" class="nav-link text-white">OSF</a></li>
        </ul>

      </div>
      <!-- Grid column -->

      <hr class="clearfix w-100 d-md-none pb-3">

      <!-- Grid column -->
      <div class="col-md-6 mb-md-0 mb-3">

        <!-- Links -->
        <h5 class="text-uppercase">Partners</h5>

        <ul class="list-group">
          <li class="list-group-item border-0 bg-primary">
            <a target="_blank" href="https://www.cos.io/" class="text-white">Center for Open Science</a>
          </li>
          <li class="list-group-item border-0 bg-primary">
            <a target="_blank" href="https://curatescience.org/" class="text-white">Curate Science</a>
          </li>
          <li class="list-group-item border-0 bg-primary">
            <a target="_blank" href="https://capbs.github.io/2020/" class="text-white">CAPBS 2020</a>
          </li>
        </ul>

      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row -->

  </div>
  <!-- Footer Links -->

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3" style="color: rgba(255,255,255,0.6); background-color: rgba(0, 0, 0, 0.2)">
      The website is designed by: <a class="text-white" href="https://github.com/ray306" target="_blank">Jinbiao Yang</a> @ Chinese Open Science Network</a> </br> Â© 2020 Copyright:<a class="text-white" href="https://mdbootstrap.com/education/bootstrap/" target="_blank"> MDBootstrap.com </a> 
  </div>
  <!-- Copyright -->

</footer>
<!-- Footer -->

  <!-- jQuery -->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>

  <script type="text/javascript" src="js/airtable.browser.js"></script>

  <script>
    var Airtable = require('airtable');
    var base = new Airtable({apiKey: 'keyH8BSM9AqwRF3ci'}).base('appHcqdzInQBWW8qr');
    function pad(a,b){return(1e6+a+"").slice(-b)}

    function show_events(filterFormula){
      $("#e_list").empty()

      base('Table 1').select({
         maxRecords: 10,
         view: "Grid view",
        filterByFormula: filterFormula,
         sort: [{field: "Date", direction: "desc"}]
       }).eachPage(function page(records, fetchNextPage) {
        records.forEach(function(record) {
          date = new Date(record.get('Date'));
          url = record.get("URL")!=undefined ? '<button type="button" class="btn"><a href="'+record.get("URL")+'" target="_blank">More</a></button>' : ''
          console.log(url)
          new_event = '<div class="card mb-4 "> <div class="card-header"><strong>'+
                      date.getFullYear()+'/'+pad(date.getMonth()+1,2)+'/'+pad(date.getDate(),2)+' '+pad(date.getHours(),2)+':'+pad(date.getMinutes(),2)+
                      '</strong></div> <div class="card-body"> <h5 style="margin-top:-5px;margin-bottom:10px"><span class="badge bg-primary">'+
                      record.get("Topics").join(', ')+
                      '</span><h5><h4 class="card-title">'+
                      record.get("Title")+
                      '</h4> <h5 class="card-title font-italic">'+
                      record.get("Speaker")+
                      '</h5> <h5 class="card-title font-italic">'+
                      record.get("Location")+
                      '</h5> <p>'+
                      record.get("Detail")+
                      '</p>'+url+' </div> </div>'
                      
          $("#e_list").append(new_event);
        })
       }, function done(err) {
           if (err) { console.error(err); return; }
       });
    }

    function show_all_events(){
      show_events('TRUE()');
      $("#btn_opentalk").removeClass('d-none');
      $("#btn_all").addClass('d-none');
    }

    function show_opentalk_events(){
      show_events("FIND('OpenTalk', ARRAYJOIN({Topics}, ' ') ) > 0");
      $("#btn_all").removeClass('d-none');
      $("#btn_opentalk").addClass('d-none');
    }

    if (new URLSearchParams(window.location.search).get('opentalk')){
      show_opentalk_events();
    }
    else{
      show_all_events();
    }


  </script>

</body>
</html>
